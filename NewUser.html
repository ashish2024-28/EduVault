<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Create Account</title>
<!-- link css file -->
 <link rel="stylesheet" href="CommonFolder/LoginPage/common.css">

<style>
  
  h2 {
    text-align: center;
    margin-bottom: 15px;
    color: #333;
  }
  input, select {
    width: 100%;
    padding: 10px;
    margin: 8px 0;
    border: 1px solid #ccc;
    border-radius: 6px;
  }
  button {
    width: 100%;
    padding: 10px;
    background: #007bff;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 10px;
  }
  button:hover {
    background: #0056b3;
  }
  .hidden {
    display: none;
  }
  .otp-note {
    font-size: 14px;
    color: green;
    margin: 8px 0;
    text-align: center;
  }
</style>

</head>

<body>
<div class="container">
  
   <div class="circle">
                <img id="imgLogo" src="" alt="">
    </div>

  <!-- Combined Login & Role Selection -->
  <div id="loginRoleDiv">
    <h2>Sign in  Portal</h2>
    <input type="text" id="name" placeholder="Enter Name" required autofocus>
    <input type="email" id="gmail" placeholder="Enter Email"  pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$" required>
    <input type="text" id="UniversityName" placeholder="Institute/University Name" required>
    <input type="password" id="password" placeholder="Create password " >
    
    <select id="roleSelect" onchange="roleChanged()">
      <option value="">--Select Role--</option>
      <option value="student">Student</option>
      <option value="Faculty">Faculty</option>
    </select>

    <!-- Student extra fields -->
    <div id="studentFields" class="hidden">
      <input type="text" id="course" placeholder="Enter Course">
      <input type="text" id="branch" placeholder="Enter Branch">
      <input type="text" id="batch" placeholder="Enter Batch">
    </div>

    <button onclick="loginNext()">Login</button>
  </div>

  <!-- OTP Verification -->
  <div id="otpDiv" class="hidden">
    <h2>OTP Verification</h2>
    <p class="otp-note" id="otpNote"></p>
    <input type="text" id="otp" placeholder="Enter OTP" required>
    <button onclick="verifyOTP()">Verify & Submit</button>
  </div>

</div>



<!-- link js file  -->
<script src="CommonFolder/LoginPage/common.js"></script>
<script>

let generatedOTP = null;
let tempUser = null;

// Show/hide student fields based on role
function roleChanged() {
  const role = document.getElementById("roleSelect").value.toLowerCase();
  if (role === "student") {
    document.getElementById("studentFields").classList.remove("hidden");
  } else {
    document.getElementById("studentFields").classList.add("hidden");
  }
}

function loginNext() {
  const name = document.getElementById("name").value.trim();
  const email = document.getElementById("gmail").value.trim().toLowerCase();
  const University = document.getElementById("UniversityName").value.trim().toLowerCase();
  const password = document.getElementById("password").value;
  let role = document.getElementById("roleSelect").value.trim().toLowerCase();

  if (!name || !email || !password || !role) {
    alert("Please fill all required fields!");
    return;
  }

  // Check email uniqueness
  const users = JSON.parse(localStorage.getItem("users")) || [];
  if (users.some(u => u.email === email)) {
    alert("This email is already registered. Use another email or login.");
    return;
  }

  let user = { name, email, password,University, role };

  if (role === "student") {
    const course = document.getElementById("course").value.trim();
    const branch = document.getElementById("branch").value.trim();
    const batch = document.getElementById("batch").value.trim();

    if (!course || !branch || !batch) {
      alert("Please fill all student details!");
      return;
    }
    user.course = course;
    user.branch = branch;
    user.batch = batch;
  }

  // Hold temp user until OTP verification
  tempUser = user;

  // Generate OTP & show OTP section
  generateOTP();
  showOtpSection();
}

function generateOTP() {
  generatedOTP = Math.floor(100000 + Math.random() * 900000);
  document.getElementById("otpNote").innerText = "Your OTP (for demo): " + generatedOTP;
}

function showOtpSection() {
  document.getElementById("loginRoleDiv").classList.add("hidden");
  document.getElementById("otpDiv").classList.remove("hidden");
}

function verifyOTP() {
  const otp = document.getElementById("otp").value.trim();
  if (!otp) { alert("Please enter OTP."); return; }

  if (otp === String(generatedOTP)) {
    // Save user to localStorage
    const users = JSON.parse(localStorage.getItem("users")) || [];
    users.push(tempUser);
    localStorage.setItem("users", JSON.stringify(users));

    alert("Account Created & Verified Successfully! üéâ");
    redirectByRole(tempUser.role);
    clearTemp()

  } else {
    alert("Invalid OTP ‚ùå");
  }
}

function redirectByRole(role) {
  if (role === "faculty") {
    window.location.href = "loginPage.html";
  } else if (role === "student") {
    window.location.href = "loginPage.html";
  } else {
    window.location.href = "/";
  }
}

// Optional: clear tempUser if needed
function clearTemp() {
  tempUser = null;
  generatedOTP = null;
}



</script>
</body>
</html>
